<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¹ç°¡èˆ‡æ¨™é»å…¨è‡ªå‹•è½‰æ›(LOFç‰ˆ)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/opencc-js@1.0.5/dist/umd/full.js"></script>

    <style>
         body { 
        font-family: "Microsoft JhengHei", "Heiti TC", sans-serif; 
        
        background-color: #dfdfe1; 
        }
        /* ç°¡å–®çš„æ—‹è½‰å‹•ç•« */
        .spin { animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- åœ–ç¤ºçµ„ä»¶ (å…§åµŒ SVG ä»¥é¿å…ä¾è³´å¤–éƒ¨åº«) ---
        const IconType = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-blue-600"><polyline points="4 7 4 4 20 4 20 7"></polyline><line x1="9" y1="20" x2="15" y2="20"></line><line x1="12" y1="4" x2="12" y2="20"></line></svg>
        );
        const IconRefreshCw = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg>
        );
        const IconTrash2 = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="mr-1"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
        );
        const IconCopy = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
        );
        const IconCheck = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="20 6 9 17 4 12"></polyline></svg>
        );

        // --- ä¸»ç¨‹å¼ ---
        function App() {
            const [inputText, setInputText] = useState('');
            const [outputText, setOutputText] = useState('');
            const [isCopied, setIsCopied] = useState(false);
            const [converterReady, setConverterReady] = useState(false);
            const openccRef = useRef(null);

            // è¼‰å…¥ OpenCC
            useEffect(() => {
                const initConverter = () => {
                    if (window.OpenCC) {
                        try {
                            openccRef.current = window.OpenCC.Converter({ from: 'cn', to: 'tw' });
                            setConverterReady(true);
                        } catch (e) {
                            console.error("OpenCC init error:", e);
                        }
                    } else {
                        setTimeout(initConverter, 500);
                    }
                };
                initConverter();
            }, []);

            const convertPunctuation = (text) => {
                let result = text;
                const punctMap = {
                    ',': 'ï¼Œ', '.': 'ã€‚', '?': 'ï¼Ÿ', '!': 'ï¼', ':': 'ï¼š', ';': 'ï¼›',
                    '(': 'ï¼ˆ', ')': 'ï¼‰', '[': 'ã€', ']': 'ã€‘', '{': 'ï½›', '}': 'ï½',
                    '<': 'ã€Š', '>': 'ã€‹', '/': 'ï¼', '\\': 'ï¼¼', '|': 'ï½œ',
                    '@': 'ï¼ ', '#': 'ï¼ƒ', '$': 'ï¼„', '%': 'ï¼…', '^': 'ï¸¿', '&': 'ï¼†',
                    '_': 'ï¼¿', '+': 'ï¼‹', '-': 'ï¼', '=': 'ï¼', '~': 'ï½', '`': 'â€µ',
                    'â€œ': 'ã€Œ', 'â€': 'ã€', 'â€˜': 'ã€', 'â€™': 'ã€'                  
                };

                result = result.replace(/[,.? !:;()\[\]{}<>\/\\|@#$%^&_+\-=~`â€œâ€â€˜â€™]/g, (match) => {
                    return punctMap[match] || match;
                });
                
                result = result.replace(/"/g, 'ã€');
                result = result.replace(/'/g, 'â€™');
                
                return result;
            };

            const handleConvert = (text) => {
                let processed = text;

                // æ­¥é©Ÿ 1: HTML è½‰ç´”æ–‡å­— 
                if (processed.includes('<') || processed.includes('ã€Š')) {
                    let htmlCleaned = processed.replace(/ã€Š/g, '<').replace(/ã€‹/g, '>'); 
                    
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = htmlCleaned;
                    
                    processed = tempDiv.textContent || '';
                    
                    processed = processed.replace(/(\n\s*){2,}/g, '\n\n').trim(); 
                }

                // æ­¥é©Ÿ 2: è™•ç†çœç•¥è™Ÿ
                processed = processed.replace(/\.{6}/g, "â€¦â€¦"); 
                processed = processed.replace(/\.{3}/g, "â€¦â€¦"); 
                
                // æ­¥é©Ÿ 3: ç°¡è½‰ç¹
                if (converterReady && openccRef.current) {
                    processed = openccRef.current(processed);
                }
                
                // æ­¥é©Ÿ 4: æ¨™é»å…¨å½¢åŒ–
                processed = convertPunctuation(processed);
                
                setOutputText(processed);
            };

            const handleInputChange = (e) => {
                const text = e.target.value;
                setInputText(text);
                handleConvert(text);
            };

            const handleCopy = () => {
                if (!outputText) return;
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(outputText)
                        .then(() => {
                            setIsCopied(true);
                            setTimeout(() => setIsCopied(false), 2000);
                        });
                } else {
                    const textArea = document.createElement("textarea");
                    textArea.value = outputText;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    setIsCopied(true);
                    setTimeout(() => setIsCopied(false), 2000);
                }
            };


            const handlePaste = async () => {
                try {
                const text = await navigator.clipboard.readText();
                    setInputText(text);
                    handleConvert(text);
                } catch (err) {
                    alert("ç„¡æ³•è®€å–å‰ªè²¼ç°¿ï¼Œè«‹ç¢ºèªç€è¦½å™¨æ¬Šé™ï¼");
                }
            };

            
            const handleClear = () => {
                setInputText('');
                setOutputText('');
            };

            return (
                <>
                <div className="min-h-screen p-4 md:p-8 font-sans text-slate-800">
                    <div className="max-w-3xl mx-auto space-y-6">
                        
                        {/* æ¨™é¡Œå€ */}
                        <div className="text-center space-y-2">
                            <h1 className="text-2xl md:text-3xl font-bold text-slate-900 flex items-center justify-center gap-2">
                                <IconType />
                                ç¹ç°¡èˆ‡æ¨™é»è½‰æ›ï¼ˆLOFï¼‰
                            </h1>
                            <p className="text-slate-500 text-sm md:text-base">
                                æ”¯æ´ HTML è‡ªå‹•è½‰ç´”æ–‡å­— â†’ ç°¡é«”è½‰ç¹é«” â†’ åŠå½¢æ¨™é»è½‰ç‚ºå…¨å½¢ã€‚
                                {!converterReady && (
                                    <span className="inline-flex items-center ml-2 text-amber-600 text-xs">
                                        <IconRefreshCw className="w-3 h-3 mr-1 spin" />
                                        è½‰æ›æ ¸å¿ƒè¼‰å…¥ä¸­...
                                    </span>
                                )}
                            </p>
                        </div>

                        {/* ä¸»ä»‹é¢ - ç§»é™¤ Grid å’Œå›ºå®šé«˜åº¦ï¼Œæ”¹ç”¨ space-y è®“å…§å®¹è‡ªå‹•æµå‹• */}
                        <div className="space-y-4"> 
                            
                            {/* ä¸Šæ–¹è¼¸å…¥ - é™åˆ¶é«˜åº¦ç‚º h-64 (256px) ä¸¦ç¶­æŒå…§éƒ¨æ»¾å‹• */}
                            <div className="flex flex-col bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden h-64">
                                <div className="flex justify-between items-center px-4 py-2 bg-slate-100 border-b border-slate-200">
                                    <label className="text-sm font-semibold text-slate-600">
                                        è¼¸å…¥
                                    </label>

                                    <div className="flex items-center gap-2">
                                        {inputText && (
                                            <button
                                                onClick={handleClear}
                                                className="text-xs flex items-center text-slate-400 hover:text-red-500 transition-colors"
                                            >
                                                <IconTrash2 /> æ¸…ç©º
                                            </button>
                                        )}
                                    </div>
                                </div>

                                <textarea
                                    className="flex-1 p-4 resize-none outline-none text-base md:text-lg leading-relaxed"
                                    placeholder="è«‹åœ¨æ­¤è²¼ä¸Šæ–‡å­—ï¼Œç³»çµ±æœƒè‡ªå‹•è™•ç† HTML æ¨™ç±¤ã€ç¹ç°¡åŠæ¨™é»..."
                                    value={inputText}
                                    onChange={handleInputChange}
                                    spellCheck="false"
                                />
                            </div>
                           
                            {/* è²¼ä¸ŠæŒ‰éˆ• */}
                            <div className="flex justify-end mb-2">
                                <button
                                    onClick={handlePaste}
                                    className="px-4 py-2 rounded-lg bg-blue-600 text-white text-sm font-semibold shadow hover:bg-blue-700 transition"
                                >
                                    ğŸ“‹ è²¼ä¸Š
                                </button>
                            </div>


                            {/* ä¸‹æ–¹è¼¸å‡º - ç§»é™¤ textareaï¼Œæ”¹ç”¨ div è®“å…§å®¹è‡ªå‹•å±•é–‹ */}
                            <div className="relative bg-white rounded-xl shadow-sm border border-blue-200 group">
                                <div className="flex justify-between items-center px-4 py-2 bg-blue-50 border-b border-blue-100">
                                    <label className="text-sm font-semibold text-blue-800">è½‰æ›çµæœ </label>
                                    <button
                                        onClick={handleCopy}
                                        disabled={!outputText}
                                        className={`flex items-center gap-1.5 px-3 py-1 rounded-md text-xs font-medium transition-all duration-200 ${!outputText ? 'opacity-50 cursor-not-allowed text-slate-400' : isCopied ? 'bg-green-500 text-white' : 'bg-white text-blue-600 border border-blue-200 hover:bg-blue-50'}`}
                                    >
                                        {isCopied ? <><IconCheck className="w-3 h-3" /> å·²è¤‡è£½</> : <><IconCopy className="w-3 h-3" /> è¤‡è£½å…§å®¹</>}
                                    </button>
                                </div>
                                {/* ä½¿ç”¨ div æ›¿ä»£ textareaï¼Œä¸¦ç”¨ whitespace-pre-wrap ä¿æŒæ›è¡Œå’Œç©ºæ ¼ */}
                                <div
                                    className="p-4 bg-white text-base md:text-lg leading-relaxed whitespace-pre-wrap cursor-text font-medium"
                                    style={{ minHeight: '100px', color: '#333333' }} // ç¢ºä¿å³ä½¿å…§å®¹å¾ˆå°‘ä¹Ÿæœ‰å¯è¦–ç©ºé–“
                                >
                                    {outputText || "è½‰æ›å¾Œçš„çµæœæœƒé¡¯ç¤ºåœ¨é€™è£¡..."}
                                </div>
                                
                                {/* æ‰‹æ©Ÿç‰ˆè¤‡è£½æŒ‰éˆ• (ç¶­æŒåŸä¾†çš„çµ•å°å®šä½å’Œéš±è—é‚è¼¯) */}
                                {outputText && (
                                    <button onClick={handleCopy} className={`md:hidden absolute bottom-4 right-4 p-3 rounded-full shadow-lg transition-all transform active:scale-95 ${isCopied ? 'bg-green-500 text-white' : 'bg-blue-600 text-white'}`}>
                                        {isCopied ? <IconCheck className="w-6 h-6" /> : <IconCopy className="w-6 h-6" />}
                                    </button>
                                )}
                            </div>

                        </div>
                        <div className="text-center text-xs text-slate-400 mt-6"> {/* å¢åŠ é–“è· */}
                          
                        </div>
                    </div>
                </div>
                    
                    {/* å›åˆ°é ‚éƒ¨æŒ‰éˆ•ï¼Œç¾åœ¨å·²è¢«æ­£ç¢ºåŒ…è£åœ¨ Fragment å…§ */}
                    {outputText && (
                        <button
                            onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })}
                            className="fixed bottom-6 right-6 z-50 px-4 py-2 rounded-full bg-blue-600 text-white shadow-lg hover:bg-blue-700 transition"
                        >
                            â¬† å›åˆ°é ‚éƒ¨
                        </button>
                    )}
                </> 
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
