<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è½‰æ›æ–œé«”æ ¼å¼</title>

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>

<style>
  body { font-family: "Microsoft JhengHei", sans-serif; }
</style>
</head>
<body class="bg-slate-50 p-4 md:p-8">

<div class="max-w-3xl mx-auto space-y-6">

  <!-- æ¨™é¡Œ -->
  <h2 class="text-2xl md:text-3xl font-bold text-center text-slate-800">
    è½‰æ›æ–œé«”æ ¼å¼å·¥å…·
  </h2>

  <!-- ä¸Šå‚³å€ -->
  <div>
    <label class="font-semibold text-slate-600">ä¸Šå‚³æ–‡å­—æª” (.txt)ï¼š</label>
    <input type="file" id="fileInput" accept=".txt"
      class="mt-1 block w-full text-sm text-slate-600
             file:mr-4 file:py-2 file:px-4
             file:rounded-lg file:border-0
             file:text-sm file:font-semibold
             file:bg-blue-600 file:text-white
             hover:file:bg-blue-700
             cursor-pointer">
  </div>

  <!-- è¼¸å…¥æ¬„ä½ -->
  <div>
    <label class="font-semibold text-slate-600">è¼¸å…¥æ¬„ä½ï¼š</label>
    <textarea id="inputText"
      class="w-full h-48 p-3 mt-1 rounded-lg border border-slate-300
             bg-white outline-none focus:ring-2 focus:ring-blue-400
             resize-none text-base"
      placeholder="åœ¨é€™è£¡è²¼ä¸Šæˆ–è¼¸å…¥æ–‡å­—"></textarea>
  </div>

  <!-- æŒ‰éˆ•åˆ— -->
  <div class="flex flex-col md:flex-row md:justify-center gap-3">
    <button id="pasteBtn"
      class="px-4 py-2 rounded-lg bg-green-600 text-white text-base hover:bg-green-700 shadow">
      ğŸ“‹ è²¼ä¸Š
    </button>

    <button id="copyBtn"
      class="px-4 py-2 rounded-lg bg-blue-600 text-white text-base hover:bg-blue-700 shadow">
      âœ‚ï¸ è¤‡è£½
    </button>
  </div>

  <!-- çµæœ -->
  <div>
    <h3 class="text-lg font-semibold text-slate-700 mb-1">è½‰æ›çµæœï¼š</h3>
    <div id="output"
      class="min-h-48 w-full p-3 whitespace-pre-wrap bg-white rounded-lg border border-slate-300 text-base">
    </div>
  </div>

  <!-- è½‰æ› & ä¸‹è¼‰ -->
  <div class="flex flex-col md:flex-row md:justify-center gap-3 mt-4">
    <button onclick="runTransform()"
      class="px-4 py-2 rounded-lg bg-purple-600 text-white text-base hover:bg-purple-700 shadow">
      è½‰æ›
    </button>

    <button id="downloadBtn"
      class="px-4 py-2 rounded-lg bg-orange-500 text-white text-base hover:bg-orange-600 shadow">
      â¬‡ï¸ ä¸‹è¼‰ (.txt)
    </button>
  </div>

</div>

<script>
let latestOutput = "";

// å·¨é›†ï¼ˆå®Œå…¨ä¿ç•™ä½ çš„é‚è¼¯ï¼‰
function transformText(text) {
  text = text.replace(/(^|\n)/g, "$1@#%");
  text = text.replace(/(\n|$)/g, "@#%$1");
  text = text.replace(/@#%ã€Œ([^ã€]+)ã€/g, "@#%ã€Œ$1ã€@#%");
  text = text.replace(/ã€Œ([^ã€]+)ã€@#%/g, "@#%ã€Œ$1ã€@#%");
  text = text.replace(/ï¼šã€Œ([^ã€]+)ã€/g, "ï¼š*ã€Œ$1ã€*");
  text = text.replace(/@#%@#%/g, "");
  text = text.replace(/@#%/g, "*");
  text = text.replace(/ã€\*(\n|$)/g, "ã€$1");
  return text;
}

function runTransform() {
  const input = inputArea.value;
  if (!input) return;
  const output = transformText(input);
  outputArea.textContent = output;
  latestOutput = output;
}

// ä¸‹è¼‰çµæœ
function downloadText() {
  if (!latestOutput) return alert("è«‹å…ˆè¼¸å…¥æˆ–è²¼ä¸Šæ–‡å­—ï¼");
  const blob = new Blob([latestOutput], { type: "text/plain;charset=utf-8" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "è½‰æ›çµæœ.txt";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

// å…ƒç´ 
const inputArea = document.getElementById("inputText");
const outputArea = document.getElementById("output");

// ä¸€éµè²¼ä¸Š
document.getElementById("pasteBtn").addEventListener("click", async () => {
  try {
    const text = await navigator.clipboard.readText();
    inputArea.value = text;
    runTransform();
  } catch {
    alert("âš ï¸ ç„¡æ³•è®€å–å‰ªè²¼ç°¿ï¼Œè«‹ç¢ºèªå·²æˆæ¬Š");
  }
});

// ä¸€éµè¤‡è£½
document.getElementById("copyBtn").addEventListener("click", async () => {
  try {
    await navigator.clipboard.writeText(outputArea.innerText);
    const btn = document.getElementById("copyBtn");
    const old = btn.innerText;
    btn.innerText = "å·²è¤‡è£½ï¼";
    setTimeout(() => btn.innerText = old, 1200);
  } catch {
    alert("âš ï¸ è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸å–");
  }
});

// ä¸‹è¼‰
document.getElementById("downloadBtn").addEventListener("click", downloadText);

// æª”æ¡ˆä¸Šå‚³
document.getElementById("fileInput").addEventListener('change', (event) => {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = (e) => {
    inputArea.value = e.target.result;
    runTransform();
  };
  reader.readAsText(file, "UTF-8");
});

// å³æ™‚è½‰æ›
inputArea.addEventListener("input", runTransform);
</script>

</body>
</html>
