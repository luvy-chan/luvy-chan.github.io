<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¹ç°¡èˆ‡æ¨™é»å…¨è‡ªå‹•è½‰æ›å™¨</title>
    
    <!-- 1. è¼‰å…¥ Tailwind CSS (æ¨£å¼åº«) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. è¼‰å…¥ React å’Œ ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 3. è¼‰å…¥ Babel (è®“ç€è¦½å™¨èƒ½çœ‹æ‡‚ JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 4. è¼‰å…¥ OpenCC (ç¹ç°¡è½‰æ›åº«) -->
    <script src="https://cdn.jsdelivr.net/npm/opencc-js@1.0.5/dist/umd/full.js"></script>

    <style>
        body { font-family: "Microsoft JhengHei", "Heiti TC", sans-serif; }
        /* ç°¡å–®çš„æ—‹è½‰å‹•ç•« */
        .spin { animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <!-- é€™è£¡æ˜¯ React ç¨‹å¼ç¢¼ -->
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- åœ–ç¤ºçµ„ä»¶ (å…§åµŒ SVG ä»¥é¿å…ä¾è³´å¤–éƒ¨åº«) ---
        const IconType = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-blue-600"><polyline points="4 7 4 4 20 4 20 7"></polyline><line x1="9" y1="20" x2="15" y2="20"></line><line x1="12" y1="4" x2="12" y2="20"></line></svg>
        );
        const IconRefreshCw = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg>
        );
        const IconTrash2 = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="mr-1"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
        );
        const IconArrowDown = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="19 12 12 19 5 12"></polyline></svg>
        );
        const IconCopy = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
        );
        const IconCheck = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="20 6 9 17 4 12"></polyline></svg>
        );

        // --- ä¸»ç¨‹å¼ ---
        function App() {
            const [inputText, setInputText] = useState('');
            const [outputText, setOutputText] = useState('');
            const [isCopied, setIsCopied] = useState(false);
            const [converterReady, setConverterReady] = useState(false);
            const openccRef = useRef(null);

            // è¼‰å…¥ OpenCC
            useEffect(() => {
                // é€™è£¡ç¨å¾®ä¿®æ”¹ï¼Œå› ç‚ºæˆ‘å€‘å·²ç¶“åœ¨ head è¼‰å…¥ opencc äº†
                const initConverter = () => {
                    if (window.OpenCC) {
                        try {
                            openccRef.current = window.OpenCC.Converter({ from: 'cn', to: 'tw' });
                            setConverterReady(true);
                        } catch (e) {
                            console.error("OpenCC init error:", e);
                        }
                    } else {
                        // å¦‚æœå°šæœªè¼‰å…¥ï¼Œç¨å¾Œé‡è©¦
                        setTimeout(initConverter, 500);
                    }
                };
                initConverter();
            }, []);

            const convertPunctuation = (text) => {
                let result = text;
                result = result.replace(/<br\s*\/?>/gi, '\n');
                
                const punctMap = {
                    ',': 'ï¼Œ', '.': 'ã€‚', '?': 'ï¼Ÿ', '!': 'ï¼', ':': 'ï¼š', ';': 'ï¼›',
                    '(': 'ï¼ˆ', ')': 'ï¼‰', '[': 'ã€', ']': 'ã€‘', '{': 'ï½›', '}': 'ï½',
                    '<': 'ã€Š', '>': 'ã€‹', '/': 'ï¼', '\\': 'ï¼¼', '|': 'ï½œ',
                    '@': 'ï¼ ', '#': 'ï¼ƒ', '$': 'ï¼„', '%': 'ï¼…', '^': 'ï¸¿', '&': 'ï¼†',
                    // '*': 'ï¼Š', // ä¿ç•™åŠå½¢
                    '_': 'ï¼¿', '+': 'ï¼‹', '-': 'ï¼', '=': 'ï¼', '~': 'ï½', '`': 'â€µ',
                    'â€œ': 'ã€Œ',   // æ–°å¢ï¼šå·¦å¼•è™Ÿ
                    'â€': 'ã€'    // æ–°å¢ï¼šå³å¼•è™Ÿ
                };

                result = result.replace(/[,.? !:;()\[\]{}<>\/\\|@#$%^&_+\-=~`â€œâ€]/g, (match) => {
                    return punctMap[match] || match;
                });

                return result;
            };

            const handleConvert = (text) => {
                let processed = text;
                if (converterReady && openccRef.current) {
                    processed = openccRef.current(processed);
                }
                processed = convertPunctuation(processed);
                setOutputText(processed);
            };

            const handleInputChange = (e) => {
                const text = e.target.value;
                setInputText(text);
                handleConvert(text);
            };

            const handleCopy = () => {
                if (!outputText) return;
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(outputText)
                        .then(() => {
                            setIsCopied(true);
                            setTimeout(() => setIsCopied(false), 2000);
                        });
                } else {
                    const textArea = document.createElement("textarea");
                    textArea.value = outputText;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    setIsCopied(true);
                    setTimeout(() => setIsCopied(false), 2000);
                }
            };


            const handlePaste = async () => {
                try {
                const text = await navigator.clipboard.readText();
                    setInputText(text);
                    handleConvert(text);
                } catch (err) {
                    alert("ç„¡æ³•è®€å–å‰ªè²¼ç°¿ï¼Œè«‹ç¢ºèªç€è¦½å™¨æ¬Šé™ï¼");
                }
            };

            
            const handleClear = () => {
                setInputText('');
                setOutputText('');
            };

 return (
  <>
    <div className="min-h-screen p-4 md:p-8 font-sans text-slate-800 overflow-auto">
      <div className="max-w-3xl mx-auto space-y-6">
        {/* æ¨™é¡Œå€ + è¼¸å…¥ + è¼¸å‡º */}
        <div className="text-center space-y-2">
          <h1 className="text-2xl md:text-3xl font-bold text-slate-900 flex items-center justify-center gap-2">
            <IconType /> ç¹ç°¡èˆ‡æ¨™é»å…¨è‡ªå‹•è½‰æ›å™¨
          </h1>
          <p className="text-slate-500 text-sm md:text-base">
            è‡ªå‹•å°‡ã€Œç°¡é«”è½‰ç¹é«”ã€ä¸¦å°‡ã€ŒåŠå½¢æ¨™é»è½‰ç‚ºå…¨å½¢ã€ã€‚
            {!converterReady && (
              <span className="inline-flex items-center ml-2 text-amber-600 text-xs">
                <IconRefreshCw className="w-3 h-3 mr-1 spin" /> è½‰æ›æ ¸å¿ƒè¼‰å…¥ä¸­...
              </span>
            )}
          </p>
        </div>

        {/* ä¸Šæ–¹è¼¸å…¥å€ */}
        <div className="flex flex-col bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
          <div className="flex justify-between items-center px-4 py-2 bg-slate-100 border-b border-slate-200">
            <label className="text-sm font-semibold text-slate-600">
              è¼¸å…¥æ–‡å­— (ç°¡/ç¹/åŠå½¢æ¨™é»)
            </label>
            {inputText && (
              <button
                onClick={handleClear}
                className="text-xs flex items-center text-slate-400 hover:text-red-500 transition-colors"
              >
                <IconTrash2 /> æ¸…ç©º
              </button>
            )}
          </div>
          <textarea
            className="flex-1 p-4 resize-none outline-none text-base md:text-lg leading-relaxed"
            placeholder="è«‹åœ¨æ­¤è²¼ä¸Šæ–‡å­—ï¼Œç³»çµ±æœƒè‡ªå‹•è™•ç†..."
            value={inputText}
            onChange={handleInputChange}
            spellCheck="false"
          />
        </div>

        {/* è¼¸å…¥å·¥å…·åˆ— */}
        <div className="flex justify-end mb-2">
          <button
            onClick={handlePaste}
            className="px-4 py-2 rounded-lg bg-blue-600 text-white text-sm font-semibold shadow hover:bg-blue-700 transition"
          >
            ğŸ“‹ è²¼ä¸Šå‰ªè²¼ç°¿
          </button>
        </div>

        {/* ä¸‹æ–¹è¼¸å‡ºå€ */}
        <div className="relative flex flex-col bg-white rounded-xl shadow-sm border border-slate-200 overflow-visible group">
          <div className="flex justify-between items-center px-4 py-2 bg-blue-50 border-b border-blue-100">
            <label className="text-sm font-semibold text-blue-800">
              è½‰æ›çµæœ (ç¹é«” + å…¨å½¢æ¨™é»)
            </label>
            <button
              onClick={handleCopy}
              disabled={!outputText}
              className={`flex items-center gap-1.5 px-3 py-1 rounded-md text-xs font-medium transition-all duration-200 ${
                !outputText
                  ? 'opacity-50 cursor-not-allowed text-slate-400'
                  : isCopied
                  ? 'bg-green-500 text-white'
                  : 'bg-white text-blue-600 border border-blue-200 hover:bg-blue-50'
              }`}
            >
              {isCopied ? (
                <>
                  <IconCheck className="w-3 h-3" /> å·²è¤‡è£½
                </>
              ) : (
                <>
                  <IconCopy className="w-3 h-3" /> è¤‡è£½å…§å®¹
                </>
              )}
            </button>
          </div>
          <div className="p-4 w-full bg-slate-50/50 text-base md:text-lg leading-relaxed text-slate-800 cursor-text whitespace-pre-wrap">
            {outputText}
          </div>
        </div>

        <div className="text-center text-xs text-slate-400">
          <p>
            æ³¨æ„ï¼šç‰¹æ®Šæ•¸å­¸ç¬¦è™Ÿæˆ–ç¨‹å¼ç¢¼å»ºè­°åˆ†é–‹è™•ç†ï¼Œä»¥å…æ¨™é»è¢«æ„å¤–è½‰æ›ã€‚
          </p>
          <p className="mt-1">
            æ­¤ç‚ºå–®æ©Ÿç‰ˆï¼Œè«‹ç¢ºä¿ç¶²è·¯é€£ç·šä»¥è¼‰å…¥è½‰æ›æ ¸å¿ƒã€‚
          </p>
        </div>
      </div>
    </div>

    {/* âœ… å›åˆ°é ‚éƒ¨æŒ‰éˆ• - åªæ”¾ä¸€æ¬¡åœ¨ fragment å¤–å±¤ */}
    {outputText && (
      <button
        onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })}
        className="fixed bottom-6 right-6 z-50 px-4 py-2 rounded-full bg-blue-600 text-white shadow-lg hover:bg-blue-700 transition"
      >
        â¬† å›åˆ°é ‚éƒ¨
      </button>
    )}
  </>
);

        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
